# MAXIMALIST DASHBOARD
# Energy View
# Made by Madelena Mak 2022

title: Energy
path: 'energy'

type: 'custom:grid-layout'
layout: !include ../shared/snippets/layout-page-margin.yaml

cards:
  - type: 'custom:layout-card'
    layout_type: 'custom:grid-layout'
    view_layout:
      grid-area: cc
    layout:
      grid-template-columns: 'repeat(auto-fill, [col-start] minmax(356px, 1fr) [col-end])'
      grid-template-rows: auto
      grid-column-gap: 32px
      margin: -1px
      mediaquery:
        '(max-width: 799.99px)':
          grid-template-columns: 'repeat(auto-fill, [col-start] minmax(240px, 1fr) [col-end])'

    cards:

      # [Header] Summary
      - type: 'custom:layout-card'
        layout_type: 'custom:grid-layout'
        layout: !include ../shared/snippets/layout-page-title.yaml
        view_layout:
          grid-column: 1/-1
        cards:

          - type: markdown
            style: !include ../shared/snippets/style-markdown-page-title.yaml
            content: >
              # Energy

              You have {{ expand('group.all_on_off')|length }} switches and
              {{
              expand('group.all_on_off')|selectattr('state','equalto','on')|list|length
              }} of them are turned on. The amount of carbon you generated today will require about
              {{ (states('sensor.total_energy_use_daily') | float / 1000 * 0.223232 * 10) | int / 10 }}
              trees to sequester for a year.

          - type: 'custom:layout-card'
            layout_type: 'custom:grid-layout'
            layout:
              margin: 0
            view_layout:
              place-self: center auto
            cards:

              - type: 'custom:swipe-card'
                parameters: !include ../shared/snippets/parameters-page-title-swipe-card.yaml
                style: !include ../shared/snippets/style-page-title-swipe-card.yaml
                cards:

                  - type: custom:state-switch
                    entity: mediaquery
                    states:
                      "(max-width: 799.99px), (min-width: 1024px)": &title-badge-1
                        type: 'custom:mushroom-entity-card'
                        entity: group.all_on_off
                        name: All Switches ↗
                        icon_color: pink
                        style: !include ../shared/snippets/style-page-title-swipe-card-tile.yaml
                        tap_action:
                          action: navigate
                          navigation_path: group.all-on-off
                      "(min-width: 800px) and (max-width: 1023.99px)":
                        <<: *title-badge-1
                        layout: vertical

                  - type: custom:state-switch
                    entity: mediaquery
                    states:
                      "(max-width: 799.99px), (min-width: 1024px)": &title-badge-2
                        type: 'custom:mushroom-template-card'
                        primary: CO₂ Intensity ↗
                        secondary: >
                          {{ states('sensor.co2_intensity') + 'g (' +
                          states('sensor.grid_fossil_fuel_percentage') + '%)' }}
                        icon: 'mdi:home-lightning-bolt'
                        icon_color: pink
                        style: !include ../shared/snippets/style-page-title-swipe-card-tile.yaml
                        tap_action:
                          action: url
                          url_path: 'https://app.electricitymap.org/zone/US-NY-NYIS'
                      "(min-width: 800px) and (max-width: 1023.99px)":
                        <<: *title-badge-2
                        layout: vertical

                  - type: custom:state-switch
                    entity: mediaquery
                    states:
                      "(max-width: 799.99px), (min-width: 1024px)": &title-badge-3
                        type: 'custom:mushroom-template-card'
                        primary: ConEdison ↗
                        icon: 'mdi:transmission-tower'
                        icon_color: pink
                        style: !include ../shared/snippets/style-page-title-swipe-card-tile.yaml
                        tap_action:
                          action: url
                          url_path: >-
                            https://www.coned.com/en/accounts-billing/dashboard?tab1=billingandusage-1&tab2=sectionEnergyBillingUsage-1&tab3=sectionEnergyHistory-2
                      "(min-width: 800px) and (max-width: 1023.99px)":
                        <<: *title-badge-3
                        layout: vertical


      # [Row] Summary + Totals
      - type: 'custom:layout-card'
        layout_type: 'custom:grid-layout'
        layout:
          margin: 0
          grid-template-columns: 'repeat(auto-fill, [col-start] minmax(360px, 1fr) [col-end])'
        view_layout:
          grid-column-start: 1
          grid-column-end: -1
        cards:

          - type: 'custom:sankey-chart'
            show_names: true
            height: 250
            min_box_height: 2
            sections:
              - entities:
                  - entity_id: sensor.total_energy_use_on_fossil_fuel
                    name: Fossil Fuel
                    color: var(--warning-color)
                    children:
                      - sensor.total_energy_use
                  - entity_id: sensor.total_energy_use_on_renewables
                    name: Renewables
                    color: var(--success-color)
                    children:
                      - sensor.total_energy_use
              - entities:
                  - entity_id: sensor.total_energy_use
                    name: Est. Total
                    children:
                      - sensor.circuit_south_power
                      - sensor.circuit_north_power
                      - sensor.circuit_center_power
                      - sensor.circuit_fridge_counter_power
                      - sensor.circuit_north_ceiling_lights_power
                      - sensor.circuit_living_room_lights_power
                      - sensor.circuit_bedroom_a_c_power
                      - sensor.circuit_living_room_projector_power
                      - sensor.bedroom_ceiling_lights_power
              - entities:
                  - entity_id: sensor.circuit_south_power
                    name: South Circuit
                    children:
                      - sensor.astralplane_plug_smartenergy_metering
                      - sensor.bedroom_devices_plug_smartenergy_metering
                      - sensor.kitchen_aerogardens_plug_smartenergy_metering
                      - sensor.living_room_air_conditioner_plug_smartenergy_metering
                      - sensor.makery_plug_smartenergy_metering
                      - sensor.quattro_plug_smartenergy_metering
                      - sensor.terpsichora_plug_smartenergy_metering
                      - sensor.kitchen_sink_lights_power
                      - sensor.kitchen_counter_accent_lights_power
                      - sensor.living_room_hue_bowl_power
                      - sensor.living_room_table_lights_power
                      - sensor.bedroom_cloud_light_power
                  - entity_id: sensor.circuit_north_power
                    name: North Circuit
                    children:
                      - sensor.valhalla_plug_smartenergy_metering
                  - entity_id: sensor.circuit_center_power
                    name: Center Circuit
                    children:
                      - sensor.dorothy_devices_plug_smartenergy_metering
                      - sensor.dorothy_plug_smartenergy_metering
                      - sensor.living_room_strala_light_power
                  - entity_id: sensor.circuit_fridge_counter_power
                    name: Fridge + Counter
                    children:
                      - sensor.kitchen_fridge_plug_smartenergy_metering
                      - sensor.kitchen_microwave_plug_smartenergy_metering
                      - sensor.kitchen_counter_echo_plug_current_consumption
                      - sensor.kitchen_counter_hand_blender_current_consumption
                      - sensor.kitchen_counter_kettle_current_consumption
                      - sensor.kitchen_counter_plug_3_current_consumption
                      - sensor.kitchen_counter_rice_cooker_current_consumption
                      - sensor.kitchen_counter_toaster_current_consumption
                  - entity_id: sensor.circuit_north_ceiling_lights_power
                    name: North Ceiling Lights
                    children:
                      - sensor.hallway_light_power
                  - entity_id: sensor.circuit_living_room_lights_power
                    name: Living Room Lights
                    children:
                      - sensor.living_room_chandelier_main_power
                      - sensor.kitchen_spot_lights_power
                      - sensor.kitchen_counter_lights_power
                  - entity_id: sensor.circuit_bedroom_a_c_power
                    name: Bedroom A/C Circuit
                    children:
                      - sensor.bedroom_air_conditioner_plug_smartenergy_metering
                  - entity_id: sensor.circuit_living_room_projector_power
                    name: Living Room Ceiling Circuit
                    children:
                      - >-
                        sensor.living_room_projector_plug_smartenergy_metering
                      - sensor.living_room_decor_lights_power
                      - sensor.living_room_ramsele_light_power
                      - sensor.living_room_random_light_power
                  - entity_id: sensor.bedroom_ceiling_lights_power
                    name: Bedroom Ceiling Circuit
                    children:
                      - sensor.bedroom_ceiling_lights_power
              - entities:
                  - entity_id: sensor.astralplane_plug_smartenergy_metering
                    name: Astralplane
                    children:
                      - sensor.all_computers_energy_use
                  - entity_id: sensor.dorothy_plug_smartenergy_metering
                    name: Dorothy
                    children:
                      - sensor.all_computers_energy_use
                  - entity_id: sensor.makery_plug_smartenergy_metering
                    name: Makery
                    children:
                      - sensor.all_computers_energy_use
                  - entity_id: sensor.quattro_plug_smartenergy_metering
                    name: Quattro
                    children:
                      - sensor.all_computers_energy_use
                  - entity_id: sensor.valhalla_plug_smartenergy_metering
                    name: Valhalla
                    children:
                      - sensor.all_computers_energy_use
                  - entity_id: sensor.living_room_air_conditioner_plug_smartenergy_metering
                    name: Living Room A/C
                    children:
                      - sensor.all_climate_energy_use
                  - entity_id: sensor.bedroom_air_conditioner_plug_smartenergy_metering
                    name: Bedroom A/C
                    children:
                      - sensor.all_climate_energy_use
                  - entity_id: sensor.dorothy_devices_plug_smartenergy_metering
                    name: Dorothy Devices
                    children:
                      - sensor.all_entertainment_energy_use
                  - entity_id: sensor.terpsichora_plug_smartenergy_metering
                    name: Terpsichora
                    children:
                      - sensor.all_entertainment_energy_use
                  - entity_id: sensor.living_room_projector_plug_smartenergy_metering
                    name: Living Room Projector
                    children:
                      - sensor.all_entertainment_energy_use
                  - entity_id: sensor.kitchen_aerogardens_plug_smartenergy_metering
                    name: Aerogardens
                    children:
                      - sensor.all_kitchen_energy_use
                  - entity_id: sensor.kitchen_fridge_plug_smartenergy_metering
                    name: Fridge
                    children:
                      - sensor.all_kitchen_energy_use
                  - entity_id: sensor.kitchen_microwave_plug_smartenergy_metering
                    name: Microwave
                    children:
                      - sensor.all_kitchen_energy_use
                  - entity_id: sensor.kitchen_counter_echo_plug_current_consumption
                    name: Echo Plug
                    children:
                      - sensor.all_kitchen_energy_use
                  - entity_id: sensor.kitchen_counter_hand_blender_current_consumption
                    name: Hand Blender
                    children:
                      - sensor.all_kitchen_energy_use
                  - entity_id: sensor.kitchen_counter_kettle_current_consumption
                    name: Kettle
                    children:
                      - sensor.all_kitchen_energy_use
                  - entity_id: sensor.kitchen_counter_plug_3_current_consumption
                    name: Plug 3
                    children:
                      - sensor.all_kitchen_energy_use
                  - entity_id: sensor.kitchen_counter_rice_cooker_current_consumption
                    name: Rice Cooker
                    children:
                      - sensor.all_kitchen_energy_use
                  - entity_id: sensor.kitchen_counter_toaster_current_consumption
                    name: Toaster
                    children:
                      - sensor.all_kitchen_energy_use
                  - entity_id: sensor.kitchen_sink_lights_power
                    name: Kitchen Sink Lights
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.kitchen_counter_accent_lights_power
                    name: Kitchen Counter Accent
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.living_room_random_light_power
                    name: Living Room Random Light
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.living_room_ramsele_light_power
                    name: Living Room Ramsele Light
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.living_room_strala_light_power
                    name: Living Room Strala Light
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.living_room_hue_bowl_power
                    name: Living Room Hue Bowl
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.living_room_table_lights_power
                    name: Living Room Table Lights
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.living_room_chandelier_main_power
                    name: Living Room Chandelier
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.kitchen_spot_lights_power
                    name: Kitchen Spot Lights
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.kitchen_counter_lights_power
                    name: Kitchen Counter Lights
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.living_room_decor_lights_power
                    name: Living Room Decor Lights
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.hallway_light_power
                    name: Hallway Light
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.bedroom_ceiling_lights_power
                    name: Bedroom Ceiling Lights
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.bedroom_cloud_light_power
                    name: Bedroom Cloud Light
                    children:
                      - sensor.all_lights_energy_use
                  - entity_id: sensor.bedroom_devices_plug_smartenergy_metering
                    name: Bedroom Devices
              - entities:
                  - entity_id: sensor.all_computers_energy_use
                    name: Computers
                    color: maroon
                  - entity_id: sensor.all_climate_energy_use
                    name: Climate
                    color: green
                  - entity_id: sensor.all_entertainment_energy_use
                    name: Entertainment
                    color: teal
                  - entity_id: sensor.all_kitchen_energy_use
                    name: Kitchen
                    color: purple
                  - entity_id: sensor.all_lights_energy_use
                    name: Lights
                    color: yellow
            view_layout:
              grid-column: 1/-1
            card_mod:
              style: >
                ha-card { background: none; }

                .connectors { left: 8px !important; right: 4px !important; }

                .box div:first-child { width: 4px !important; }

                .box .label { padding-left: 8px !important; font-weight:
                500;}

                .box .label span { font-weight: normal; font-style: normal
                !important; }
                .box .label span.state { font-weight: 600; }
                .box .label span.name { font-size: inherit; }
                .section:last-child { flex-grow: .667 !important; flex-shrink: 2 !important; }

          - type: 'custom:button-card'
            template: header_card_no_link
            variables:
              name: SUMMARY
            view_layout:
              grid-column: 1/-1

          - !include ../shared/cards/energy-current-total.yaml

          - !include ../shared/cards/energy-daily-total.yaml
              
          - type: vertical-stack
            in_card: true
            cards:
              - type: 'custom:apexcharts-card'
                header:
                  show: true
                  title: Energy Usage Share
                chart_type: donut
                layout: minimal
                update_interval: 10sec
                series:
                  - entity: sensor.astralplane_plug_smartenergy_metering
                    name: Astralplane
                  - entity: sensor.dorothy_plug_smartenergy_metering
                    name: Dorothy
                  - entity: sensor.dorothy_devices_plug_smartenergy_metering
                    name: Dorothy Devices
                  - entity: sensor.quattro_plug_smartenergy_metering
                    name: Quattro
                  - entity: sensor.terpsichora_plug_smartenergy_metering
                    name: Terpsichora
                  - entity: sensor.valhalla_plug_smartenergy_metering
                    name: Valhalla
                  - entity: sensor.makery_plug_smartenergy_metering
                    name: Makery
                  - entity: sensor.kitchen_microwave_plug_smartenergy_metering
                    name: Kitchen Microwave
                  - entity: sensor.kitchen_fridge_plug_smartenergy_metering
                    name: Kitchen Fridge
                  - entity: sensor.kitchen_aerogardens_plug_smartenergy_metering
                    name: Kitchen Aerogardens
                  - entity: sensor.kitchen_counter_kettle_current_consumption
                    name: Kitchen Kettle
                  - entity: sensor.bedroom_air_conditioner_plug_smartenergy_metering
                    name: Bedroom AC
                  - entity: sensor.bedroom_devices_plug_smartenergy_metering
                    name: Bedroom Devices
                  - entity: sensor.living_room_air_conditioner_plug_smartenergy_metering
                    name: Living Room AC
                  - entity: sensor.living_room_projector_plug_smartenergy_metering
                    name: Living Room Projector
                  - entity: sensor.unaccounted_lights_energy_use
                    name: Other Lights
                apex_config:
                  chart:
                    height: 500px
                    fontFamily: 'Segoe UI, SegoeUI, sans-serif'
                    offsetY: -20
                    pie:
                      donut:
                        label:
                          show: true
                  title:
                    style:
                      fontSize: 12px
                      color: var(--primary-text-color)
                  legend:
                    formatter: |
                      EVAL:function(seriesName, opts) {
                        return seriesName
                      }
                    position: right
                    fontSize: 12
                    fontFamily: 'Segoe UI, SegoeUI, sans-serif'
                    fontWeight: normal
                    markers:
                      width: 8
                      height: 8
                    itemMargin:
                      horizontal: 0
                  dataLabels:
                    formatter: >
                      EVAL:function(value, { seriesIndex, dataPointIndex, w
                      }) {
                        return Math.round(value * 10) / 10 + '%'
                      }
                    style:
                      fontSize: 10
                      fontFamily: 'Segoe UI, SegoeUI, sans-serif'
                      fontWeight: 500
                    dropShadow:
                      enabled: false
                  tooltip:
                    style:
                      fontSize: 12px
                      fontFamily: 'Segoe UI, SegoeUI, sans-serif'
                style: |
                  #header__title {
                    font-size: var(--body-font-size) !important;
                    font-weight: normal !important;
                    color: var(--primary-text-color) !important;
                    margin-top: 8px;
                  }
                  #graph-wrapper {
                    padding-top: 32px;
                  }


      # [Column] Workspace

      - type: 'custom:layout-card'
        layout_type: 'custom:grid-layout'
        layout:
          margin: -1        
        cards:

          - type: 'custom:button-card'
            template: header_card_no_link
            variables:
              name: WORKSPACE

          - type: 'custom:auto-entities'
            filter:
              template: |
                {% for sensor in expand('group.energy_workspace') -%}
                  {%- set name = state_attr(sensor.entity_id,"friendly_name") | regex_replace(find='smartenergy_metering', replace='') | regex_replace(find=' Plug', replace='') | regex_replace(find='Energy Use', replace='') -%}
                  {{
                    { 'entity': sensor.entity_id,
                      'type': 'custom:decluttering-card',
                      'template': 'multi_graph_card',
                      'name': name,
                      'variables': [
                        {'hours_to_show': 48},
                        {'entities': [sensor.entity_id]},
                        {'title': name},
                        {'lower_bound': 0},
                        {'upper_bound': '~200'},
                        {'height': 128},
                        {'show_extrema': true},
                        {'animate': false}
                      ],
                    }
                  }},
                {%- endfor %}
            sort:
              method: state
              reverse: true
              numeric: true
            card:
              type: 'custom:layout-card'
              layout_type: 'custom:grid-layout'
              layout_options:
                margin: -1


      # [Column] Bedroom

      - type: 'custom:layout-card'
        layout_type: 'custom:grid-layout'
        layout:
          margin: -1        
        cards:

          - type: 'custom:button-card'
            template: header_card_no_link
            variables:
              name: BEDROOM

          - type: 'custom:auto-entities'
            filter:
              template: |
                {% for sensor in expand('group.energy_bedroom') -%}
                  {%- set name = state_attr(sensor.entity_id,"friendly_name") | regex_replace(find='smartenergy_metering', replace='') | regex_replace(find=' Plug', replace='') | regex_replace(find='Energy Use', replace='') -%}
                  {{
                    { 'entity': sensor.entity_id,
                      'type': 'custom:decluttering-card',
                      'template': 'multi_graph_card',
                      'name': name,
                      'variables': [
                        {'hours_to_show': 48},
                        {'entities': [sensor.entity_id]},
                        {'title': name},
                        {'lower_bound': 0},
                        {'upper_bound': '~200'},
                        {'height': 128},
                        {'show_extrema': true},
                        {'animate': false}
                      ],
                    }
                  }},
                {%- endfor %}
            sort:
              method: state
              reverse: true
              numeric: true
            card:
              type: 'custom:layout-card'
              layout_type: 'custom:grid-layout'
              layout_options:
                margin: -1


      # [Column] Kitchen

      - type: 'custom:layout-card'
        layout_type: 'custom:grid-layout'
        layout:
          margin: -1        
        cards:

          - type: 'custom:button-card'
            template: header_card_no_link
            variables:
              name: KITCHEN

          - type: 'custom:auto-entities'
            filter:
              template: |
                {% for sensor in expand('group.energy_kitchen') -%}
                  {%- set name = state_attr(sensor.entity_id,"friendly_name") | regex_replace(find='smartenergy_metering', replace='') | regex_replace(find=' Plug', replace='') | regex_replace(find='Energy Use', replace='') -%}
                  {{
                    { 'entity': sensor.entity_id,
                      'type': 'custom:decluttering-card',
                      'template': 'multi_graph_card',
                      'name': name,
                      'variables': [
                        {'hours_to_show': 48},
                        {'entities': [sensor.entity_id]},
                        {'title': name},
                        {'lower_bound': 0},
                        {'upper_bound': '~200'},
                        {'height': 128},
                        {'show_extrema': true},
                        {'animate': false}
                      ],
                    }
                  }},
                {%- endfor %}
            sort:
              method: state
              reverse: true
              numeric: true
            card:
              type: 'custom:layout-card'
              layout_type: 'custom:grid-layout'
              layout_options:
                margin: -1


      # [Column] Living Room

      - type: 'custom:layout-card'
        layout_type: 'custom:grid-layout'
        layout:
          margin: -1        
        cards:

          - type: 'custom:button-card'
            template: header_card_no_link
            variables:
              name: LIVING ROOM

          - type: 'custom:auto-entities'
            filter:
              template: |
                {% for sensor in expand('group.energy_living_room') -%}
                  {%- set name = state_attr(sensor.entity_id,"friendly_name") | regex_replace(find='smartenergy_metering', replace='') | regex_replace(find=' Plug', replace='') | regex_replace(find='Energy Use', replace='') -%}
                  {{
                    { 'entity': sensor.entity_id,
                      'type': 'custom:decluttering-card',
                      'template': 'multi_graph_card',
                      'name': name,
                      'variables': [
                        {'hours_to_show': 48},
                        {'entities': [sensor.entity_id]},
                        {'title': name},
                        {'lower_bound': 0},
                        {'upper_bound': '~200'},
                        {'height': 128},
                        {'show_extrema': true},
                        {'animate': false}
                      ],
                    }
                  }},
                {%- endfor %}
            sort:
              method: state
              reverse: true
              numeric: true
            card:
              type: 'custom:layout-card'
              layout_type: 'custom:grid-layout'
              layout_options:
                margin: -1


      # [Column] Misc

      - type: 'custom:layout-card'
        layout_type: 'custom:grid-layout'
        layout:
          margin: -1        
        cards:

          - type: 'custom:button-card'
            template: header_card_no_link
            variables:
              name: MISC

          - type: custom:decluttering-card
            template: multi_graph_card
            variables:
              - hours_to_show: 48
              - entities:
                - sensor.valhalla_plug_smartenergy_metering
              - title: Valhalla
              - lower_bound: 0
              - upper_bound: ~200
              - height: 128
              - show_extrema: true
              - animate: false

          - type: custom:decluttering-card
            template: multi_graph_card
            variables:
              - hours_to_show: 48
              - entities:
                - sensor.all_lights_energy_use
              - title: All Lights
              - lower_bound: 0
              - upper_bound: ~200
              - height: 128
              - show_extrema: true
              - animate: false
            icon: 'mdi:lightbulb-group'


      # [Column] Kitchen Power Strip

      - type: 'custom:layout-card'
        layout_type: 'custom:grid-layout'
        layout:
          margin: -1        
        cards:

          - type: 'custom:button-card'
            template: header_card
            variables:
              name: KITCHEN POWER STRIP
              label: Manage
              link: /config/devices/device/c5a3a945ac7eaae21b84bb6d4650eefd

          - type: 'custom:auto-entities'
            filter:
              template: |
                {% for sensor in expand('group.energy_kitchen_power_strip') -%}
                  {%- set name = state_attr(sensor.entity_id,"friendly_name") | regex_replace(find='Current Consumption', replace='') | regex_replace(find=' Plug', replace='') | regex_replace(find='Energy Use', replace='') -%}
                  {{
                    { 'entity': sensor.entity_id,
                      'type': 'custom:decluttering-card',
                      'template': 'multi_graph_card',
                      'name': name,
                      'variables': [
                        {'hours_to_show': 48},
                        {'entities': [sensor.entity_id]},
                        {'title': name},
                        {'lower_bound': 0},
                        {'upper_bound': '~200'},
                        {'height': 128},
                        {'show_extrema': true},
                        {'animate': false}
                      ],
                    }
                  }},
                {%- endfor %}
            sort:
              method: state
              reverse: true
              numeric: true
            card:
              type: 'custom:layout-card'
              layout_type: 'custom:grid-layout'
              layout_options:
                margin: -1
